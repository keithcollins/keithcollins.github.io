<!DOCTYPE html><html lang="en"> <head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><!-- Primary Meta Tags --><title>The Good Forms by Keith Collins</title><meta name="title" content="The Good Forms by Keith Collins"><meta name="description" content="Music and software by Good Forms/Keith Collins"><link rel="canonical" href="https://keithcollins.github.io/goodforms/"><!-- Open Graph / Facebook --><meta property="og:type" content="website"><meta property="og:url" content="https://keithcollins.github.io/goodforms/"><meta property="og:title" content="The Good Forms by Keith Collins"><meta property="og:description" content="Music and software by Good Forms/Keith Collins"><meta property="og:image" content="https://keithcollins.github.io/images/og-image.jpg"><!-- Twitter --><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://keithcollins.github.io/goodforms/"><meta property="twitter:title" content="The Good Forms by Keith Collins"><meta property="twitter:description" content="Music and software by Good Forms/Keith Collins"><meta property="twitter:image" content="https://keithcollins.github.io/images/og-image.jpg"><!-- Favicon --><link rel="icon" href=""><!-- Fonts --><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap" rel="stylesheet"><link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:wght@200;300;400;500;700&display=swap" rel="stylesheet"><style>pre[data-astro-cid-xewuvtsi]{background:#f4f4f4;border:1px solid #ddd;border-radius:4px;padding:1rem;overflow-x:auto}code[data-astro-cid-xewuvtsi]{background:#f4f4f4;padding:.2rem .4rem;border-radius:3px;font-family:Monaco,Courier New,monospace}pre[data-astro-cid-xewuvtsi] code[data-astro-cid-xewuvtsi]{background:none;padding:0}table[data-astro-cid-xewuvtsi]{border-collapse:collapse;width:100%;margin:1rem 0}th[data-astro-cid-xewuvtsi],td[data-astro-cid-xewuvtsi]{border:1px solid #ddd;padding:.5rem;text-align:left}th[data-astro-cid-xewuvtsi]{background:#f4f4f4}
header[data-astro-cid-3ef6ksr2]{margin-bottom:20px}h1[data-astro-cid-3ef6ksr2]{font-weight:400;margin:20px 0 10px}h1[data-astro-cid-3ef6ksr2] span[data-astro-cid-3ef6ksr2]{font-weight:700}h1[data-astro-cid-3ef6ksr2] a[data-astro-cid-3ef6ksr2]{color:#333;text-decoration:none}h1[data-astro-cid-3ef6ksr2] a[data-astro-cid-3ef6ksr2]:hover{text-decoration:underline}.breadcrumbs[data-astro-cid-3ef6ksr2]{font-size:14px;color:#666;margin-bottom:20px}.breadcrumbs[data-astro-cid-3ef6ksr2] a[data-astro-cid-3ef6ksr2]{color:#06c;text-decoration:none}.breadcrumbs[data-astro-cid-3ef6ksr2] a[data-astro-cid-3ef6ksr2]:hover{text-decoration:underline}.separator[data-astro-cid-3ef6ksr2]{color:#999}*{box-sizing:border-box}body{margin:0;padding:10px;font-family:Roboto,sans-serif;font-size:16px;line-height:1.5;color:#333}main{position:relative;max-width:600px;margin:0 auto}main.game-size{max-width:400px}h1,h2,h3,h4,h5,h6{line-height:1.3}a{color:#06c}code{font-family:Source Code Pro,menlo,inconsolata,monospace;font-size:calc(1em - 2px);color:#555;background-color:#f0f0f0;padding:.2em .4em;border-radius:2px}pre{background-color:#f9f9f9;box-shadow:inset 1px 1px 5px #0000000d;padding:.5em;border-radius:2px;overflow-x:auto}pre code{background:none;padding:0}img{max-width:100%;height:auto}
</style></head> <body> <main class=""> <header data-astro-cid-3ef6ksr2><h1 data-astro-cid-3ef6ksr2><a href="/" data-astro-cid-3ef6ksr2><span data-astro-cid-3ef6ksr2>The Good Forms</span> by Keith Collins</a></h1></header><nav class="breadcrumbs" data-astro-cid-3ef6ksr2><a href="/" data-astro-cid-3ef6ksr2>home</a><span class="separator" data-astro-cid-3ef6ksr2> / </span><a href="/goodforms" data-astro-cid-3ef6ksr2>goodforms</a></nav>  <p data-astro-cid-xewuvtsi> <strong data-astro-cid-xewuvtsi>The Good Forms</strong> is a music and software project. 
    I release experimental instrumental music and 
    Max for Live devices under this name.
</p> <p data-astro-cid-xewuvtsi>
‚û°Ô∏è <strong data-astro-cid-xewuvtsi>Follow Good Forms on <a href="https://soundcloud.com/goodforms" data-astro-cid-xewuvtsi>Soundcloud</a>, <a href="https://tiktok.com/@thegoodforms" data-astro-cid-xewuvtsi>TikTok</a> and <a href="https://x.com/thegoodforms" data-astro-cid-xewuvtsi>Twitter</a>.</strong> </p> <h2 data-astro-cid-xewuvtsi>Introducing my first Max for Live Device</h2> <img src="/images/m4l/demo1.png" data-astro-cid-xewuvtsi> <p data-astro-cid-xewuvtsi>My first M4L device (which I am currently calling <strong data-astro-cid-xewuvtsi>Smush</strong>) allows you to load a sample and remove audio below a dB threshold that you set. It "smushes" the remaining audio segments together with smooth crossfades, which you also control.</p> <img src="/images/m4l/demo2.png" data-astro-cid-xewuvtsi> <p data-astro-cid-xewuvtsi>This creates a new, condensed version of the original sample that can be bounced to a new audio track.</p> <p data-astro-cid-xewuvtsi>The device is built around a V8 JavaScript engine, providing a dynamic and responsive user interface for controlling the editing process.</p> <p data-astro-cid-xewuvtsi>Here is a brief demo video:</p> <video controls width="335" style="max-width: 335px;" data-astro-cid-xewuvtsi> <source src="/images/m4l/smushtest.mp4" type="video/mp4" data-astro-cid-xewuvtsi>
Your browser does not support the video tag.
</video> <div style="font-size:30px; line-height:1.4; margin: 20px 0 15px 0" data-astro-cid-xewuvtsi>Would you like to help beta-test this device? If so, <a href="https://docs.google.com/forms/d/e/1FAIpQLSfxVyWYxZrfpKM_Aa9UyU2P3QWhGbDlhsg35I5fMJsIyy99HA/viewform" data-astro-cid-xewuvtsi>please fill out this form!</a></div> <h2 data-astro-cid-xewuvtsi>Core Features</h2> <ul data-astro-cid-xewuvtsi> <li data-astro-cid-xewuvtsi> <strong data-astro-cid-xewuvtsi>Silence Detection</strong>: Analyzes an audio sample to identify regions of silence based on a user-definable dB threshold.
</li> <li data-astro-cid-xewuvtsi> <strong data-astro-cid-xewuvtsi>Audio Combining</strong>: Creates a new audio buffer containing only the parts of the original sample above the set threshold.
</li> <li data-astro-cid-xewuvtsi> <strong data-astro-cid-xewuvtsi>Automatic Crossfading</strong>: Applies smooth equal-power or linear crossfades between the joined audio segments to prevent clicks and pops. The crossfading can also be turned off, so that the kept regions are combined without overlaps.
</li> <li data-astro-cid-xewuvtsi> <strong data-astro-cid-xewuvtsi>Visuals</strong>:
<ul data-astro-cid-xewuvtsi> <li data-astro-cid-xewuvtsi>The top waveform display shows the original audio and highlights the detected silent regions.</li> <li data-astro-cid-xewuvtsi>The combined audio is displayed in the lower waveform..</li> </ul> </li> <li data-astro-cid-xewuvtsi>The combined audio can be currently be played back via MIDI notes.</li> <li data-astro-cid-xewuvtsi> <strong data-astro-cid-xewuvtsi>Configurable Parameters</strong>:
<ul data-astro-cid-xewuvtsi> <li data-astro-cid-xewuvtsi><strong data-astro-cid-xewuvtsi>Threshold</strong>: Sets the dB level below which audio is considered silent. The device intelligently suggests an initial threshold based on the audio's dynamics.</li> <li data-astro-cid-xewuvtsi><strong data-astro-cid-xewuvtsi>Min. Window</strong>: Defines the shortest duration of silence that will be kept.</li> <li data-astro-cid-xewuvtsi><strong data-astro-cid-xewuvtsi>Crossfade Curve</strong>: Allows switching between equal power, linear or no crossfade curves.</li> <li data-astro-cid-xewuvtsi><strong data-astro-cid-xewuvtsi>Crossfade Duration</strong>: Sets the total length of the crossfade.</li> </ul> </li> </ul> <img src="/images/m4l/patcher.png" data-astro-cid-xewuvtsi> <hr data-astro-cid-xewuvtsi> <h2 data-astro-cid-xewuvtsi>Development Log</h2> <p data-astro-cid-xewuvtsi>
I am keeping a log of my progress and I build this device, 
    to keep track of the changes as I go and, hopefully, to 
    help fellow developers. Please get in touch if you have questions 
    or suggestions!
</p> <p data-astro-cid-xewuvtsi>Here's a snapshot of the project statistics as of Feb. 9, 2026:</p> <p data-astro-cid-xewuvtsi><strong data-astro-cid-xewuvtsi>Total commits:</strong> 77</p> <p data-astro-cid-xewuvtsi><strong data-astro-cid-xewuvtsi>Most changed files:</strong></p> <ol data-astro-cid-xewuvtsi> <li data-astro-cid-xewuvtsi><code data-astro-cid-xewuvtsi>index.js</code> - 56 commits, 353 lines (final)</li> <li data-astro-cid-xewuvtsi> <code data-astro-cid-xewuvtsi>v8ui.js</code> ‚Üí <code data-astro-cid-xewuvtsi>mainGraphics.js</code> + <code data-astro-cid-xewuvtsi>smushGraphics.js</code> - 21 commits total
</li> </ol> <p data-astro-cid-xewuvtsi><strong data-astro-cid-xewuvtsi>Lines of code (final count):</strong></p> <ul data-astro-cid-xewuvtsi> <li data-astro-cid-xewuvtsi><code data-astro-cid-xewuvtsi>index.js</code>: 353 lines</li> <li data-astro-cid-xewuvtsi><code data-astro-cid-xewuvtsi>state.js</code>: 216 lines</li> <li data-astro-cid-xewuvtsi><code data-astro-cid-xewuvtsi>smush.js</code>: 292 lines</li> <li data-astro-cid-xewuvtsi><code data-astro-cid-xewuvtsi>findAudioRegions.js</code>: 109 lines</li> <li data-astro-cid-xewuvtsi><code data-astro-cid-xewuvtsi>audioBouncer.js</code>: 380 lines</li> <li data-astro-cid-xewuvtsi><code data-astro-cid-xewuvtsi>bufferManager.js</code>: 120 lines</li> <li data-astro-cid-xewuvtsi><code data-astro-cid-xewuvtsi>maxObjectManager.js</code>: 265 lines</li> <li data-astro-cid-xewuvtsi><code data-astro-cid-xewuvtsi>mainGraphics.js</code>: 243 lines</li> <li data-astro-cid-xewuvtsi><code data-astro-cid-xewuvtsi>smushGraphics.js</code>: ~90 lines</li> <li data-astro-cid-xewuvtsi><code data-astro-cid-xewuvtsi>getBufferMinMax.js</code>: ~60 lines</li> </ul> <p data-astro-cid-xewuvtsi><strong data-astro-cid-xewuvtsi>Total:</strong> ~2,128 lines of JavaScript across 10 modules</p> <hr data-astro-cid-xewuvtsi> <h2 data-astro-cid-xewuvtsi>February 8: Problems with audio bouncing</h2> <h3 data-astro-cid-xewuvtsi>Max pains</h3> <p data-astro-cid-xewuvtsi>
I am having a lot of trouble getting the path to the temporary project
    folder Ableton Live creates for unsaved Live Sets.
</p> <p data-astro-cid-xewuvtsi>
At minimum, I would like to get the path to the user&#39;s Temporary Folder,
    which is set in Ableton Live &gt; Settings &gt; File &amp; Folder &gt;
    Temporary Folder. By default on Mac it is:
</p> <p data-astro-cid-xewuvtsi>~/Music/Ableton/Live Recordings/</p> <p data-astro-cid-xewuvtsi>
What I really want is the full path to the current Live Set in the case that
    the Set has not yet been saved:
</p> <p data-astro-cid-xewuvtsi>~/Music/Ableton/Live Recordings/2026-02-06 094518 Temp Project/</p> <p data-astro-cid-xewuvtsi>
If you create a new Live Set in Ableton Live, add audio or MIDI to a track,
    then right-click on your clip and select &quot;Bounce Track in Place&quot;
    or &quot;Bounce to New Track,&quot; Ableton saves the bounced audio to:
</p> <p data-astro-cid-xewuvtsi>
~/Music/Ableton/Live Recordings/2026-02-06 094518 Temp
    Project/Samples/Processed/Bounce
</p> <p data-astro-cid-xewuvtsi>
I simply want to follow that pattern in the device I am working on. Since my
    device allows the user to bounce audio from the device&#39;s buffer to a new
    audio track. It works fine if the Live Set has been saved, because I can get
    the path to the project folder and save the audio there. But if the Live Set
    has not yet been saved, I want to save the bounced audio the same way
    Ableton does by default.
</p> <p data-astro-cid-xewuvtsi>I do not want to save to the Max temporary folder, which for me is:</p> <p data-astro-cid-xewuvtsi>
~/Library/Application Support/Cycling &#39;74/Max 9/Settings/temp64-live
</p> <h3 data-astro-cid-xewuvtsi>Clever solution</h3> <p data-astro-cid-xewuvtsi>
I finally found a solution. It&#39;s very round-about, and if someone has a
    cleaner way to do this, please tell me. But here is what is currently
    working for me (using Live 12 and Max 9, V8 JavaScript):
</p> <p data-astro-cid-xewuvtsi>
Basically, I used Clip.crop() to trigger Live&#39;s native file management,
    which reveals the temp folder path. When you call clip.crop() on an audio
    clip, Live creates a new consolidated audio file in its managed folder
    structure. By reading the clip&#39;s file_path property before and after the
    crop operation, you can extract Live&#39;s temporary project folder path.
</p> <ul data-astro-cid-xewuvtsi> <li data-astro-cid-xewuvtsi> <p data-astro-cid-xewuvtsi>First, my device saves its output audio to Max&#39;s temp folder.</p> </li> <li data-astro-cid-xewuvtsi> <p data-astro-cid-xewuvtsi>
I use the LiveAPI to create a track and load my audio file into a clip.
</p> </li> <li data-astro-cid-xewuvtsi> <p data-astro-cid-xewuvtsi>I use a Task with a delay to ensure the clip is fully created.</p> </li> </ul> <pre data-astro-cid-xewuvtsi><code class="language-js">const discoveryTask = new Task(function() {
      const clip = new LiveAPI(`live_set tracks ${trackIndex} arrangement_clips 0`);
      
      if (clip.id == 0) {
          error(&quot;Could not access clip\n&quot;);
          return;
      }
      
      // Continue to next step...
  }, this);

  discoveryTask.schedule(100); // 100ms delay
  </code></pre> <ul data-astro-cid-xewuvtsi> <li data-astro-cid-xewuvtsi>
I trigger the crop operation and wait for Live to create the new file,
      then get the path to that file. Now the file lives in ~/Music/Ableton/Live
      Recordings/2026-02-06 185736 Temp Project/Samples/Processed/Crop which
      works for my purposes, and I now have the path to the temporary project
      folder, which I can use if the user bounces a new audio clip out of the
      device.
</li> </ul> <pre data-astro-cid-xewuvtsi><code class="language-js">// Call crop - this triggers Live's file management

  clip.call(&quot;crop&quot;);
  // Wait for crop to complete

  const checkTask = new Task(function() {
    const newPath = clip.get(&quot;file_path&quot;);

    post(`New path: ${newPath[0]}\n`);
    // Continue to extraction...
  }, this);

  checkTask.schedule(100); // 100ms delay for crop operation
  </code></pre> <h3 data-astro-cid-xewuvtsi>Audio bouncer extracted from index.js</h3> <p data-astro-cid-xewuvtsi>
Now that this works, I have extracted all bounce/export functionality into
    its own module.
</p> <p data-astro-cid-xewuvtsi> <strong data-astro-cid-xewuvtsi>Created <code data-astro-cid-xewuvtsi>audioBouncer.js</code> (380 lines)</strong> - A complete
    audio export system:
</p> <ul data-astro-cid-xewuvtsi> <li data-astro-cid-xewuvtsi>Multi-format support (WAV, AIFF, FLAC)</li> <li data-astro-cid-xewuvtsi>Bit depth options (16/24/32-bit)</li> <li data-astro-cid-xewuvtsi>Sample rate conversion</li> <li data-astro-cid-xewuvtsi>Progress tracking</li> <li data-astro-cid-xewuvtsi>Error handling</li> <li data-astro-cid-xewuvtsi>File path management</li> </ul> <p data-astro-cid-xewuvtsi> <strong data-astro-cid-xewuvtsi><code data-astro-cid-xewuvtsi>index.js</code> shrunk dramatically:</strong> 181 lines removed,
    replaced with:
</p> <pre data-astro-cid-xewuvtsi>import { AudioBouncer } from &#39;./audioBouncer.js&#39;;
  const bouncer = new AudioBouncer();
  bouncer.bounce(buffer, filepath, options);
  </pre> <hr data-astro-cid-xewuvtsi> <h2 data-astro-cid-xewuvtsi>February 3: Interactive threshold control</h2> <h3 data-astro-cid-xewuvtsi>Mouse interactions</h3> <p data-astro-cid-xewuvtsi><strong data-astro-cid-xewuvtsi>New capabilities:</strong></p> <ul data-astro-cid-xewuvtsi> <li data-astro-cid-xewuvtsi>Click-and-drag threshold adjustment</li> <li data-astro-cid-xewuvtsi>Visual feedback during interaction</li> <li data-astro-cid-xewuvtsi>Smooth value updates to UI controls</li> </ul> <p data-astro-cid-xewuvtsi> <code data-astro-cid-xewuvtsi>mainGraphics.js</code> and <code data-astro-cid-xewuvtsi>smushGraphics.js</code> got synced interaction
    patterns.
</p> <p data-astro-cid-xewuvtsi> <code data-astro-cid-xewuvtsi>state.js</code> can track interaction state: <code data-astro-cid-xewuvtsi>isHovering</code>, <code data-astro-cid-xewuvtsi>isDragging</code>, <code data-astro-cid-xewuvtsi>dragStartY</code>, etc.
</p> <p data-astro-cid-xewuvtsi><strong data-astro-cid-xewuvtsi>Polish details:</strong></p> <ul data-astro-cid-xewuvtsi> <li data-astro-cid-xewuvtsi>Worked on hover state rendering in <code data-astro-cid-xewuvtsi>mainGraphics.js</code></li> <li data-astro-cid-xewuvtsi>TODO: Cursor changes to indicate draggability</li> <li data-astro-cid-xewuvtsi>Smooth transitions between states</li> </ul> <h3 data-astro-cid-xewuvtsi>Line dragging</h3> <p data-astro-cid-xewuvtsi>Fine-tuned the drag interaction to make it feel natural.</p> <hr data-astro-cid-xewuvtsi> <h2 data-astro-cid-xewuvtsi>January 29: Crossfade visualization</h2> <h3 data-astro-cid-xewuvtsi>Merge points</h3> <p data-astro-cid-xewuvtsi>Started visualizing where audio regions get joined together.</p> <p data-astro-cid-xewuvtsi> <strong data-astro-cid-xewuvtsi>New feature in <code data-astro-cid-xewuvtsi>smushGraphics.js</code>:</strong> Draw markers at
    crossfade points so you can see exactly where the audio is being spliced.
</p> <p data-astro-cid-xewuvtsi><strong data-astro-cid-xewuvtsi>Visual design:</strong></p> <ul data-astro-cid-xewuvtsi> <li data-astro-cid-xewuvtsi>Equal-power crossfades show as smooth S-curves</li> <li data-astro-cid-xewuvtsi>Linear crossfades show as straight diagonal lines</li> <li data-astro-cid-xewuvtsi>Markers at start/end of each crossfade region</li> </ul> <p data-astro-cid-xewuvtsi>
Now you can <em data-astro-cid-xewuvtsi>see</em> how the audio is being blended. But... it&#39;s not as
    helpful as I expected. Especially for longer audio, it really just adds noise
    to the output waveform. Will likely drop it.
</p> <p data-astro-cid-xewuvtsi><strong data-astro-cid-xewuvtsi>The math behind constant/equal-power crossfading:</strong></p> <pre data-astro-cid-xewuvtsi><code class="language-javascript" data-astro-cid-xewuvtsi>// Linear: 3dB dip in the middle
  outA = inA * (1 - position);
  outB = inB * position;

  // Equal-power: constant perceived loudness
  outA = inA * Math.cos(position * Math.PI / 2);
  outB = inB * Math.sin(position * Math.PI / 2);
  </code></pre> <p data-astro-cid-xewuvtsi> <strong data-astro-cid-xewuvtsi>Why equal-power?</strong> Human perception of loudness isn&#39;t linear.
    Equal-power curves compensate for this, making crossfades sound smooth and natural.
</p> <h3 data-astro-cid-xewuvtsi>Threshold line interaction</h3> <p data-astro-cid-xewuvtsi>
Made the threshold line interactive. Now you can change the threshold via the button at the top,
    or you can click and drag the threshold like up and
    down to adjust the threshold.
</p> <p data-astro-cid-xewuvtsi><strong data-astro-cid-xewuvtsi>Implementation details (<code data-astro-cid-xewuvtsi>mainGraphics.js</code>):</strong></p> <ul data-astro-cid-xewuvtsi> <li data-astro-cid-xewuvtsi>
Mouse events in v8ui: <code data-astro-cid-xewuvtsi>onclick</code>, <code data-astro-cid-xewuvtsi>ondrag</code>, <code data-astro-cid-xewuvtsi>onidleout</code> </li> <li data-astro-cid-xewuvtsi>Convert pixel Y position to dB value</li> <li data-astro-cid-xewuvtsi>Update state</li> <li data-astro-cid-xewuvtsi>Redraw graphics</li> <li data-astro-cid-xewuvtsi>Trigger reprocessing</li> </ul> <p data-astro-cid-xewuvtsi><code data-astro-cid-xewuvtsi>smushGraphics.js</code> also got interaction improvements.</p> <hr data-astro-cid-xewuvtsi> <h2 data-astro-cid-xewuvtsi>January 27: Polishing üíé</h2> <h3 data-astro-cid-xewuvtsi>UI Updates</h3> <ul data-astro-cid-xewuvtsi> <li data-astro-cid-xewuvtsi>
Added crossfade type selector with custom icons for equal power, linear
      fade and no fade.
</li> <li data-astro-cid-xewuvtsi>Updated color scheme based on Illustrator mockups</li> </ul> <p data-astro-cid-xewuvtsi><code data-astro-cid-xewuvtsi>state.js</code> grew to accommodate new UI parameters.</p> <h3 data-astro-cid-xewuvtsi>State simplification</h3> <p data-astro-cid-xewuvtsi>
Refactored <code data-astro-cid-xewuvtsi>state.js</code> down from 222 lines to 97. Removed 125 lines
    of cruft that accumulated during development.
</p> <h3 data-astro-cid-xewuvtsi>Bounce feature</h3> <p data-astro-cid-xewuvtsi>
Added audio export functionality. You can now render the smushed audio to a
    new audio file.
</p> <p data-astro-cid-xewuvtsi><code data-astro-cid-xewuvtsi>index.js</code> is handling:</p> <ul data-astro-cid-xewuvtsi> <li data-astro-cid-xewuvtsi>File path selection</li> <li data-astro-cid-xewuvtsi>Buffer-to-disk writing</li> <li data-astro-cid-xewuvtsi>Progress feedback</li> <li data-astro-cid-xewuvtsi>Error handling</li> </ul> <h3 data-astro-cid-xewuvtsi>Trimming fat</h3> <p data-astro-cid-xewuvtsi>
Huge simplification of <code data-astro-cid-xewuvtsi>state.js</code>, and <code data-astro-cid-xewuvtsi>index.js</code> got a
    165-line overhaul improving message handling and state synchronization.
</p> <h3 data-astro-cid-xewuvtsi>Reset issues</h3> <p data-astro-cid-xewuvtsi>
It&#39;s important that the user can drop a new audio clip into the device
    at any time, even if audio was previously loaded. So it&#39;s also important
    that when that happens, the device resets.
</p> <p data-astro-cid-xewuvtsi> <strong data-astro-cid-xewuvtsi>The problem:</strong> State wasn&#39;t fully clearing when it got new
    audio. Some UI elements remembered old values, waveforms showed ghost data, etc.
</p> <h3 data-astro-cid-xewuvtsi>Buffer stuff</h3> <p data-astro-cid-xewuvtsi>Proper sequencing of buffer operations:</p> <ol data-astro-cid-xewuvtsi> <li data-astro-cid-xewuvtsi>Stop transport (prevents clicks)</li> <li data-astro-cid-xewuvtsi>Clear old buffer</li> <li data-astro-cid-xewuvtsi>Initialize new buffer</li> <li data-astro-cid-xewuvtsi>Update UI</li> <li data-astro-cid-xewuvtsi>Notify graphics layers</li> <li data-astro-cid-xewuvtsi>Resume transport if needed</li> </ol> <h3 data-astro-cid-xewuvtsi>Floor UI</h3> <p data-astro-cid-xewuvtsi>
Added an experimental &quot;floor&quot; parameter that allows the user to
    adjust the visible floor of the input audio, essentially zooming in
    vertically. It works, but it doesn&#39;t feel super helpful.
</p> <hr data-astro-cid-xewuvtsi> <h2 data-astro-cid-xewuvtsi>January 24: Good progress</h2> <h3 data-astro-cid-xewuvtsi>Design Iterations:</h3> <img src="/images/m4l/sketch-2026-01-24.png" data-astro-cid-xewuvtsi><br data-astro-cid-xewuvtsi> <img src="/images/m4l/sketch-2026-01-25.png" data-astro-cid-xewuvtsi><br data-astro-cid-xewuvtsi> <h3 data-astro-cid-xewuvtsi>Working on device reset</h3> <p data-astro-cid-xewuvtsi>Complete rewrite of the reset functionality using the new state system.</p> <p data-astro-cid-xewuvtsi>
Deleted <code data-astro-cid-xewuvtsi>v8ui.js</code>, fully switched to <code data-astro-cid-xewuvtsi>mainGraphics.js</code> and
<code data-astro-cid-xewuvtsi>smushGraphics.js</code>, each of which handles painting for their
    respective v8ui objects.
</p> <p data-astro-cid-xewuvtsi>Split graphics rendering into two specialized files:</p> <ul data-astro-cid-xewuvtsi> <li data-astro-cid-xewuvtsi><code data-astro-cid-xewuvtsi>mainGraphics.js</code> handles the main buffer visualization</li> <li data-astro-cid-xewuvtsi> <code data-astro-cid-xewuvtsi>smushGraphics.js</code> handles the smushed buffer + crossfade overlays
</li> </ul> <h3 data-astro-cid-xewuvtsi>Initialization refinement</h3> <p data-astro-cid-xewuvtsi>
Fixed a subtle race condition: the <code data-astro-cid-xewuvtsi>bufferInit</code> flag was being set
    too early in the initialization sequence, causing occasional glitches when loading
    audio quickly.
</p> <p data-astro-cid-xewuvtsi> <strong data-astro-cid-xewuvtsi>The fix:</strong> Move the flag to the very end of <code data-astro-cid-xewuvtsi>initBuffer()</code>, after ALL initialization is complete.
</p> <h3 data-astro-cid-xewuvtsi>Looking good</h3> <p data-astro-cid-xewuvtsi>
Everything is working pretty well. Reset button: ‚úÖ. Buffer loading: ‚úÖ.
    Silence detection: ‚úÖ. Crossfades: ‚úÖ. UI updates: ‚úÖ.
</p> <h3 data-astro-cid-xewuvtsi>Design work</h3> <p data-astro-cid-xewuvtsi>More UI sketching:</p> <hr data-astro-cid-xewuvtsi> <h2 data-astro-cid-xewuvtsi>January 23: (No more DataManager)</h2> <h3 data-astro-cid-xewuvtsi>DataManager ‚Üí State.js</h3> <p data-astro-cid-xewuvtsi>
Big decision: DataManager isn&#39;t working out. The Dictionary-based
    persistence is causing race conditions and state desync issues.
</p> <p data-astro-cid-xewuvtsi>
Max&#39;s Dictionary objects are great for patchers, but in JS they add
    unnecessary complexity. Switched to a plain object and Global for
    cross-script communication.
</p> <h3 data-astro-cid-xewuvtsi>New stuff</h3> <p data-astro-cid-xewuvtsi><strong data-astro-cid-xewuvtsi>Created three new files:</strong></p> <ul data-astro-cid-xewuvtsi> <li data-astro-cid-xewuvtsi> <strong data-astro-cid-xewuvtsi><code data-astro-cid-xewuvtsi>state.js</code></strong> (201 lines) - Global-based state management
</li> <li data-astro-cid-xewuvtsi> <strong data-astro-cid-xewuvtsi><code data-astro-cid-xewuvtsi>mainGraphics.js</code></strong> (138 lines) - Main waveform rendering
      logic
</li> <li data-astro-cid-xewuvtsi> <strong data-astro-cid-xewuvtsi><code data-astro-cid-xewuvtsi>smushGraphics.js</code></strong> (61 lines) - Smushed waveform
      rendering logic
</li> </ul> <p data-astro-cid-xewuvtsi><strong data-astro-cid-xewuvtsi>New architecture:</strong></p> <pre data-astro-cid-xewuvtsi><code class="language-javascript">// state.js creates a device-specific Global
  const stateGlobal = new Global(`smush_state_${deviceId}`);

  // Any script can now access/modify state
  import { state } from './state.js';
  state.thresholdDb = -40;
  </code></pre> <p data-astro-cid-xewuvtsi> <strong data-astro-cid-xewuvtsi>Why Global?</strong> Unlike Dictionaries, Globals are just JavaScript
    objects living in Max&#39;s JS engine. Fast, simple, and they work exactly how
    you&#39;d expect objects to work.
</p> <hr data-astro-cid-xewuvtsi> <h2 data-astro-cid-xewuvtsi>January 22: Snapshot, Playhead &amp; RMS‚ÜíPeak</h2> <h3 data-astro-cid-xewuvtsi>Snapshot Feature</h3> <p data-astro-cid-xewuvtsi>Added the ability to capture the current device state for recall.</p> <p data-astro-cid-xewuvtsi> <strong data-astro-cid-xewuvtsi>Refactor:</strong> Simplified <code data-astro-cid-xewuvtsi>findAudioRegions.js</code> by removing
    redundant code.
</p> <h3 data-astro-cid-xewuvtsi>Playhead Visualization</h3> <p data-astro-cid-xewuvtsi>
Rebuilt the playback playhead from scratch. Now you can see exactly where
    you are in the waveform during playback.
</p> <p data-astro-cid-xewuvtsi><strong data-astro-cid-xewuvtsi>Technical approach:</strong></p> <ul data-astro-cid-xewuvtsi> <li data-astro-cid-xewuvtsi>Listen to Max&#39;s transport position</li> <li data-astro-cid-xewuvtsi>Convert to buffer samples</li> <li data-astro-cid-xewuvtsi>Draw a vertical line in v8ui</li> <li data-astro-cid-xewuvtsi>Update at ~30fps for smooth animation</li> </ul> <h3 data-astro-cid-xewuvtsi>V8UI for Creation Waveform</h3> <p data-astro-cid-xewuvtsi>
Added a second v8ui overlay specifically for the smushed buffer
    visualization. Now both <code data-astro-cid-xewuvtsi>---main</code> and <code data-astro-cid-xewuvtsi>---smush</code> have their
    own UI layers.
</p> <h3 data-astro-cid-xewuvtsi>dB-Linear Slider</h3> <p data-astro-cid-xewuvtsi>Threshold control got a major upgrade. Worked on some UI mockups.</p> <h3 data-astro-cid-xewuvtsi>Plot~ Integration Attempt</h3> <p data-astro-cid-xewuvtsi>
Trying to figure out if <code data-astro-cid-xewuvtsi>plot~</code> would be better than <code data-astro-cid-xewuvtsi>waveform~</code> for visualization.
</p> <h3 data-astro-cid-xewuvtsi>horizontal line working, now switching from RMS to peak</h3> <p data-astro-cid-xewuvtsi>
Added the threshold visualization: a draggable horizontal line showing the
    current silence threshold in dB.
</p> <p data-astro-cid-xewuvtsi> <strong data-astro-cid-xewuvtsi>The problem:</strong> The device was using RMS (root-mean-square) for
    silence detection, but Max&#39;s <code data-astro-cid-xewuvtsi>waveform~</code> and <code data-astro-cid-xewuvtsi>plot~</code> objects display peak values. This meant the threshold line didn&#39;t align
    with the visual waveform. Confusing!
</p> <h3 data-astro-cid-xewuvtsi>implemented peak, lookin for leak</h3> <p data-astro-cid-xewuvtsi>
Switched to peak-based detection. Now the silence threshold visually aligns
    with what you see in the waveform.
</p> <p data-astro-cid-xewuvtsi> <strong data-astro-cid-xewuvtsi>But...</strong> memory leak detected. After processing several buffers,
    Max&#39;s memory usage kept climbing. üêõ
</p> <p data-astro-cid-xewuvtsi> <strong data-astro-cid-xewuvtsi>The culprit:</strong> Creating new <code data-astro-cid-xewuvtsi>Buffer</code> objects without
    freeing old ones. Each buffer is a peer object that Max has to manage. If you
    don&#39;t call <code data-astro-cid-xewuvtsi>freepeer()</code>, they accumulate in memory.
</p> <hr data-astro-cid-xewuvtsi> <h2 data-astro-cid-xewuvtsi>January 21: UI Polish &amp; Peak Detection</h2> <h3 data-astro-cid-xewuvtsi>Design Iterations:</h3> <img src="/images/m4l/proto-2026-01-20.png" data-astro-cid-xewuvtsi><br data-astro-cid-xewuvtsi> <img src="/images/m4l/proto-2026-01-22.png" data-astro-cid-xewuvtsi><br data-astro-cid-xewuvtsi> <img src="/images/m4l/sketch-2026-01-20.png" data-astro-cid-xewuvtsi><br data-astro-cid-xewuvtsi> <img src="/images/m4l/sketch-2026-01-21.png" data-astro-cid-xewuvtsi><br data-astro-cid-xewuvtsi> <img src="/images/m4l/sketch-2026-01-22.png" data-astro-cid-xewuvtsi><br data-astro-cid-xewuvtsi> <img src="/images/m4l/sketch-2026-01-22-2.png" data-astro-cid-xewuvtsi><br data-astro-cid-xewuvtsi> <h3 data-astro-cid-xewuvtsi>Design Exploration</h3> <p data-astro-cid-xewuvtsi>
Started thinking about how the threshold line should be drawn.
</p> <h3 data-astro-cid-xewuvtsi>Dropping Async</h3> <p data-astro-cid-xewuvtsi>
Something broke in the async experiment. Reverted changes to <code data-astro-cid-xewuvtsi>findAudioRegions.js</code> and <code data-astro-cid-xewuvtsi>getBufferMinMax.js</code>.
</p> <p data-astro-cid-xewuvtsi> <strong data-astro-cid-xewuvtsi>Lesson learned:</strong> Async in Max is tricky. The scheduler model is
    different from Node.js. Reverted to sync processing for stability.
</p> <h3 data-astro-cid-xewuvtsi>MIDI Integration</h3> <p data-astro-cid-xewuvtsi>Now you can trigger the smushed audio with MIDI notes.</p> <h3 data-astro-cid-xewuvtsi>State Management Overhaul</h3> <p data-astro-cid-xewuvtsi>
Three late-night commits fixing persistent state issues. The waveforms
    weren&#39;t resetting properly when loading new files.
</p> <p data-astro-cid-xewuvtsi> <strong data-astro-cid-xewuvtsi>The bug:</strong> <code data-astro-cid-xewuvtsi>v8ui</code> was holding onto stale buffer references.
</p> <p data-astro-cid-xewuvtsi> <strong data-astro-cid-xewuvtsi>The fix:</strong> Added explicit refresh messages to <code data-astro-cid-xewuvtsi>v8ui.js</code> whenever buffers change. Also improved the lifecycle: init ‚Üí load ‚Üí paint ‚Üí
    clear ‚Üí repeat.
</p> <h3 data-astro-cid-xewuvtsi>Min/Max Optimization</h3> <p data-astro-cid-xewuvtsi>
Improved <code data-astro-cid-xewuvtsi>getBufferMinMax.js</code> with smarter caching. If you&#39;re drawing
    the same region twice, don&#39;t recalculate.
</p> <hr data-astro-cid-xewuvtsi> <h2 data-astro-cid-xewuvtsi>January 17</h2> <h3 data-astro-cid-xewuvtsi>Design Iterations</h3> <img src="/images/m4l/proto-2026-01-17.png" data-astro-cid-xewuvtsi><br data-astro-cid-xewuvtsi> <img src="/images/m4l/proto-2026-01-18.png" data-astro-cid-xewuvtsi><br data-astro-cid-xewuvtsi> <img src="/images/m4l/proto-2026-01-18-2.png" data-astro-cid-xewuvtsi><br data-astro-cid-xewuvtsi> <h3 data-astro-cid-xewuvtsi>Performance Refactor</h3> <p data-astro-cid-xewuvtsi>
Tried an async version of the smush script. TypedArrays and frame-based
    processing to handle large files without blocking the Max scheduler.
</p> <p data-astro-cid-xewuvtsi> <strong data-astro-cid-xewuvtsi>Key insight:</strong> Max&#39;s <code data-astro-cid-xewuvtsi>poke~</code> is synchronous and
    can choke on big buffers. Solution: process in chunks, use <code data-astro-cid-xewuvtsi>Task</code> for
    yielding back to the scheduler. But it makes the UI slow and clunky, so may ditch.
</p> <h3 data-astro-cid-xewuvtsi>BufferManager Class</h3> <p data-astro-cid-xewuvtsi>
Created <code data-astro-cid-xewuvtsi>bufferManager.js</code> (174 lines) to handle buffer lifecycle management:
</p> <ul data-astro-cid-xewuvtsi> <li data-astro-cid-xewuvtsi>Automatic <code data-astro-cid-xewuvtsi>freepeer()</code> cleanup to prevent memory leaks</li> <li data-astro-cid-xewuvtsi>Centralized buffer creation and reference caching</li> <li data-astro-cid-xewuvtsi>Two-buffer coordination (main ‚Üî smush)</li> </ul> <p data-astro-cid-xewuvtsi>
One class owns all buffer operations. <code data-astro-cid-xewuvtsi>index.js</code> just says &quot;give
    me the main buffer&quot; and doesn&#39;t worry about the messy details.
</p> <h3 data-astro-cid-xewuvtsi>Performance Tools</h3> <p data-astro-cid-xewuvtsi>
Built <code data-astro-cid-xewuvtsi>getBufferMinMax.js</code>, a utility to quickly find min/max
    values in a buffer region for visualization scaling. Uses TypedArray <code data-astro-cid-xewuvtsi>peek()</code> for fast traversal.
</p> <p data-astro-cid-xewuvtsi> <strong data-astro-cid-xewuvtsi>Optimization:</strong> Instead of checking every single sample for waveform
    display, we sample strategically based on pixel width. If the waveform is 500
    pixels wide, we don&#39;t need to check all 2 million samples.
</p> <h3 data-astro-cid-xewuvtsi>DataManager Introduction</h3> <p data-astro-cid-xewuvtsi>
New <code data-astro-cid-xewuvtsi>dataManager.js</code> to centralize state. All the device parameters‚Äîthreshold,
    crossfade times, min region size‚Äînow live in one managed object.
</p> <p data-astro-cid-xewuvtsi><strong data-astro-cid-xewuvtsi>Design pattern:</strong> Dictionary-based data persistence.</p> <h3 data-astro-cid-xewuvtsi>MaxObjectManager</h3> <p data-astro-cid-xewuvtsi>
The modular architecture saga continues with <code data-astro-cid-xewuvtsi>maxObjectManager.js</code> (250 lines)‚Äîa caching layer for Max objects.
</p> <p data-astro-cid-xewuvtsi> <strong data-astro-cid-xewuvtsi>Problem solved:</strong> Constantly calling <code data-astro-cid-xewuvtsi>this.patcher.getnamed(&quot;some_object&quot;)</code> is expensive. This manager gets each object reference ONCE and caches it.
</p> <pre data-astro-cid-xewuvtsi><code class="language-javascript" data-astro-cid-xewuvtsi>// Old way (called every paint frame):
  const waveform = this.patcher.getnamed(&quot;waveform_display&quot;);

  // New way (cached):
  const waveform = maxObjects.get(&quot;waveform_display&quot;);
  </code></pre> <p data-astro-cid-xewuvtsi>UI redesign too, with somewhat better visual hierarchy.</p> <hr data-astro-cid-xewuvtsi> <h2 data-astro-cid-xewuvtsi>January 15</h2> <p data-astro-cid-xewuvtsi>First real commit with original core files:</p> <ul data-astro-cid-xewuvtsi> <li data-astro-cid-xewuvtsi> <strong data-astro-cid-xewuvtsi><code data-astro-cid-xewuvtsi>index.js</code></strong> (242 lines) - Main entry point and orchestrator
</li> <li data-astro-cid-xewuvtsi> <strong data-astro-cid-xewuvtsi><code data-astro-cid-xewuvtsi>smush.js</code></strong> (209 lines) - Core audio processing logic
</li> <li data-astro-cid-xewuvtsi> <strong data-astro-cid-xewuvtsi><code data-astro-cid-xewuvtsi>findAudioRegions.js</code></strong> (71 lines) - Silence detection
      algorithm
</li> <li data-astro-cid-xewuvtsi> <strong data-astro-cid-xewuvtsi><code data-astro-cid-xewuvtsi>v8ui.js</code></strong> (119 lines) - Custom UI rendering with
      Max&#39;s v8ui
</li> <li data-astro-cid-xewuvtsi> <strong data-astro-cid-xewuvtsi><code data-astro-cid-xewuvtsi>Smush.amxd</code></strong> - The Max for Live device file itself
</li> <li data-astro-cid-xewuvtsi><strong data-astro-cid-xewuvtsi><code data-astro-cid-xewuvtsi>README.md</code></strong> - Initial documentation</li> </ul> <p data-astro-cid-xewuvtsi><strong data-astro-cid-xewuvtsi>Technical decisions made:</strong></p> <ul data-astro-cid-xewuvtsi> <li data-astro-cid-xewuvtsi>V8 JavaScript engine for modern ES6+ support</li> <li data-astro-cid-xewuvtsi>
Module system with CommonJS imports/exports for clean separation of
      concerns
</li> <li data-astro-cid-xewuvtsi>Custom <code data-astro-cid-xewuvtsi>v8ui</code> overlays on native Max waveform objects</li> </ul> <h3 data-astro-cid-xewuvtsi>Two-Buffer Architecture</h3> <p data-astro-cid-xewuvtsi>Early realization: we need two buffers, not one:</p> <ul data-astro-cid-xewuvtsi> <li data-astro-cid-xewuvtsi><code data-astro-cid-xewuvtsi>---main</code>: The original, untouched audio (sacred!)</li> <li data-astro-cid-xewuvtsi><code data-astro-cid-xewuvtsi>---smush</code>: Where we do our destructive edits</li> </ul> <p data-astro-cid-xewuvtsi>This way, you can always reset back to the original.</p> <h3 data-astro-cid-xewuvtsi>Stabilization</h3> <ul data-astro-cid-xewuvtsi> <li data-astro-cid-xewuvtsi>Improved initialization reliability</li> <li data-astro-cid-xewuvtsi>Core audio processing refined</li> <li data-astro-cid-xewuvtsi>Audio playback working</li> <li data-astro-cid-xewuvtsi>
The device is somewhat working. You can drop in audio, smush it, and hear
      the result.
</li> </ul> <p data-astro-cid-xewuvtsi>
By evening: <strong data-astro-cid-xewuvtsi>finally fixed buffer clear</strong> - The reset button actually
    works now. This involved understanding Max&#39;s buffer lifecycle and when to
    call <code data-astro-cid-xewuvtsi>clear()</code> vs reassigning samples.
</p> <h3 data-astro-cid-xewuvtsi>UI &amp; Control Layer</h3> <ul data-astro-cid-xewuvtsi> <li data-astro-cid-xewuvtsi>Added transport controls</li> <li data-astro-cid-xewuvtsi>Created proper button layouts for load, reset, smush, and bounce</li> </ul> <hr data-astro-cid-xewuvtsi> <h2 data-astro-cid-xewuvtsi>January 5-7</h2> <p data-astro-cid-xewuvtsi>Getting started with the Max patcher, exploring possibilities:</p> <img src="/images/m4l/proto-2026-01-05.png" data-astro-cid-xewuvtsi><br data-astro-cid-xewuvtsi> <img src="/images/m4l/proto-2026-01-06.png" data-astro-cid-xewuvtsi><br data-astro-cid-xewuvtsi> <img src="/images/m4l/proto-2026-01-07.png" data-astro-cid-xewuvtsi>  </main> </body></html> 